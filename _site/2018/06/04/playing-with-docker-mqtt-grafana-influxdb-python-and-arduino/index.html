<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width initial-scale=1" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  

  <title>Playing with Docker, MQTT, Grafana, InfluxDB, Python and Arduino</title>
  <meta name="description" content="I must admit this post is just an excuse to play with Grafana and InfluxDb. InfluxDB is a cool database especially designed to work with time series. Grafana is one open source tool for time series analytics. I want to build a simple prototype. The idea is:

">
  <meta name="author" content="Gonzalo Ayuso">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Playing with Docker, MQTT, Grafana, InfluxDB, Python and Arduino">
  <meta name="twitter:description" content="I must admit this post is just an excuse to play with Grafana and InfluxDb. InfluxDB is a cool database especially designed to work with time series. Grafana is one open source tool for time series analytics. I want to build a simple prototype. The idea is:

">
  
  <meta name="twitter:creator" content="gonzalo123">
  
  <meta name="twitter:image" content="/images/favicons/favicon-194x194.png" />

  <meta property="og:type" content="article">
  <meta property="og:title" content="Playing with Docker, MQTT, Grafana, InfluxDB, Python and Arduino">
  <meta property="og:description" content="I must admit this post is just an excuse to play with Grafana and InfluxDb. InfluxDB is a cool database especially designed to work with time series. Grafana is one open source tool for time series analytics. I want to build a simple prototype. The idea is:

">
  <meta property="og:image" content="/images/favicons/favicon-194x194.png" />

  <link rel="apple-touch-icon" sizes="57x57" href="/images/favicons/apple-touch-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/images/favicons/apple-touch-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/images/favicons/apple-touch-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/images/favicons/apple-touch-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/images/favicons/apple-touch-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/images/favicons/apple-touch-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/images/favicons/apple-touch-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/images/favicons/apple-touch-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/favicons/apple-touch-icon-180x180.png">
  <link rel="icon" type="image/png" href="/images/favicons/favicon-32x32.png" sizes="32x32">
  <link rel="icon" type="image/png" href="/images/favicons/favicon-194x194.png" sizes="194x194">
  <link rel="icon" type="image/png" href="/images/favicons/favicon-96x96.png" sizes="96x96">
  <link rel="icon" type="image/png" href="/images/favicons/android-chrome-192x192.png" sizes="192x192">
  <link rel="icon" type="image/png" href="/images/favicons/favicon-16x16.png" sizes="16x16">
  <link rel="manifest" href="/images/favicons/manifest.json">
  <link rel="shortcut icon" href="/images/favicons/favicon.ico">
  <meta name="msapplication-TileColor" content="#ffc40d">
  <meta name="msapplication-TileImage" content="/images/favicons/mstile-144x144.png">
  <meta name="theme-color" content="#ffffff">
  
  <link rel="stylesheet" href="/css/main.css?1617453037860382000">
  <link rel="canonical" href="http://localhost:4000/2018/06/04/playing-with-docker-mqtt-grafana-influxdb-python-and-arduino/">
  <link rel="alternate" type="application/rss+xml" title="Gonzalo Ayuso" href="/feed.xml">
  <!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Playing with Docker, MQTT, Grafana, InfluxDB, Python and Arduino | Gonzalo Ayuso</title>
<meta name="generator" content="Jekyll v3.9.0" />
<meta property="og:title" content="Playing with Docker, MQTT, Grafana, InfluxDB, Python and Arduino" />
<meta name="author" content="Gonzalo Ayuso" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="I must admit this post is just an excuse to play with Grafana and InfluxDb. InfluxDB is a cool database especially designed to work with time series. Grafana is one open source tool for time series analytics. I want to build a simple prototype. The idea is:" />
<meta property="og:description" content="I must admit this post is just an excuse to play with Grafana and InfluxDb. InfluxDB is a cool database especially designed to work with time series. Grafana is one open source tool for time series analytics. I want to build a simple prototype. The idea is:" />
<link rel="canonical" href="http://localhost:4000/2018/06/04/playing-with-docker-mqtt-grafana-influxdb-python-and-arduino/" />
<meta property="og:url" content="http://localhost:4000/2018/06/04/playing-with-docker-mqtt-grafana-influxdb-python-and-arduino/" />
<meta property="og:site_name" content="Gonzalo Ayuso" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-06-04T00:00:00+02:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Playing with Docker, MQTT, Grafana, InfluxDB, Python and Arduino" />
<script type="application/ld+json">
{"headline":"Playing with Docker, MQTT, Grafana, InfluxDB, Python and Arduino","dateModified":"2018-06-04T00:00:00+02:00","datePublished":"2018-06-04T00:00:00+02:00","url":"http://localhost:4000/2018/06/04/playing-with-docker-mqtt-grafana-influxdb-python-and-arduino/","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/2018/06/04/playing-with-docker-mqtt-grafana-influxdb-python-and-arduino/"},"author":{"@type":"Person","name":"Gonzalo Ayuso"},"description":"I must admit this post is just an excuse to play with Grafana and InfluxDb. InfluxDB is a cool database especially designed to work with time series. Grafana is one open source tool for time series analytics. I want to build a simple prototype. The idea is:","@type":"BlogPosting","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

</head>


  <body>

    <span class="mobile btn-mobile-menu">
  <i class="icon icon-list btn-mobile-menu__icon"></i>
  <i class="icon icon-x-circle btn-mobile-close__icon hidden"></i>
</span>

<header class="panel-cover panel-cover--collapsed"
        style="background-image: url(/images/cover.jpg)">
    <div class="panel-main">
        <div class="panel-main__inner panel-inverted">
            <div class="panel-main__content">
                <a href="/" title="link to home of Gonzalo Ayuso">
                    <img src="/images/profile.jpg" class="user-image" alt="My Profile Photo">
                    <h1 class="panel-cover__title panel-title">Gonzalo Ayuso</h1>
                    <h3 class="panel-cover__title panel-title"><i>Web Architect</i></h3>
                </a>
                <div class="navigation-wrapper">
                    <h3 class="panel-cover__title panel-title"><i>Personal blog since 2008</i></h3>
                    <nav class="cover-navigation navigation--social">
                        <nav class="cover-navigation">
                            <ul class="navigation">
                                <li>
                                    <a href="/about" title="about">
                                        About Me
                                    </a>
                                </li>
                                <li class="navigation__item">
                                    <a href="/search" title="search">
                                         <i class="icon icon-page-search"></i>
                                        <span class="label">Search</span>
                                    </a>
                                </li>

                            </ul>
                        </nav>
                        <hr class="panel-cover__divider">
                        <ul class="navigation">
    
    <!-- Twitter -->
    <li class="navigation__item">
        <a href="http://twitter.com/gonzalo123"
           title="@gonzalo123 on Twitter" target="_blank">
            <i class="icon icon-social-twitter"></i>
            <span class="label">Twitter</span>
        </a>
    </li>
    

    
    <!-- LinkedIn -->
    <li class="navigation__item">
        <a href="https://www.linkedin.com/in/gonzaloayuso"
           title="gonzaloayuso on LinkedIn" target="_blank">
            <i class="icon icon-social-linkedin"></i>
            <span class="label">LinkedIn</span>
        </a>
    </li>
    

    
    <!-- GitHub -->
    <li class="navigation__item">
        <a href="https://www.github.com/gonzalo123"
           title="gonzalo123 on GitHub" target="_blank">
            <i class="icon icon-social-github"></i>
            <span class="label">GitHub</span>
        </a>
    </li>
    

    
    <!-- Email -->
    <li class="navigation__item">
        <a href="mailto:gonzalo123@gmail.com" title="Email gonzalo123@gmail.com"
           target="_blank">
            <i class="icon icon-mail"></i>
            <span class="label">Email</span>
        </a>
    </li>
    

    <!-- RSS -->
    <li class="navigation__item">
        <a href="/feed.xml" title="Subscribe" target="_blank">
            <i class="icon icon-rss"></i>
            <span class="label">RSS</span>
        </a>
    </li>

</ul>

                    </nav>
                    <div>
    <a href="https://leanpub.com/codigosolido"
       rel="noreferrer"
       data-ss1617366980="1">
        <img src="/assets/images/codigoSolido.png" alt="Código Sólido">
    </a>
    <p class="panel-cover__description">
        <i>
            Buy my book (Spanish) on Leanpub. (It's free but if you pay I'll donate all profits)
        </i>
    </p>
</div>

                </div>

            </div>

        </div>

        <div class="panel-cover--overlay"></div>
    </div>
</header>

    <div class="content-wrapper">
      <div class="content-wrapper__inner">
        <article class="post-container post-container--single">
    <header class="post-header">
        <div class="post-meta">
            <time datetime=" 2018-06-04 00:00
            " class="post-meta__date date">4 Jun 2018</time>
            
            &#8226; <span class="post-meta__tags">on <a
                href="/tags/#docker">docker</a>, <a
                href="/tags/#grafana">grafana</a>, <a
                href="/tags/#influxdb">influxdb</a>, <a
                href="/tags/#iot">iot</a>, <a
                href="/tags/#mosquitto">mosquitto</a>, <a
                href="/tags/#mqtt">mqtt</a>, <a
                href="/tags/#raspberry-pi">raspberry-pi</a></span>
            
        </div>
        <h1 class="post-title">Playing with Docker, MQTT, Grafana, InfluxDB, Python and Arduino</h1>
    </header>

    <section class="post">
        <p>I must admit this post is just an excuse to play with <a href="https://grafana.com/">Grafana</a> and <a href="https://www.influxdata.com/">InfluxDb</a>. InfluxDB is a cool database especially designed to work with time series. Grafana is one open source tool for time series analytics. I want to build a simple prototype. The idea is:</p>

<ul>
  <li>One Arduino device (<a href="https://www.espressif.com/en/products/hardware/esp32/overview">esp32</a>) emits a MQTT event to a <a href="https://mosquitto.org/">mosquitto</a> server. I’ll use a potentiometer to emulate one sensor (Imagine here, for example, a temperature sensor instead of potentiometer). I’ve used this circuit before in another <a href="https://gonzalo123.com/?s=iot">projects</a></li>
  <li>One Python script will be listening to the MQTT event in my Raspberry Pi and it will persist the value to InfluxDB database</li>
  <li>I will monitor the state of the time series given by the potentiometer with Grafana</li>
  <li>I will create one alert in Grafana (for example when the average value within 10 seconds is above a threshold) and I will trigger a webhook when the alert changes its state</li>
  <li>One microservice (a Python <a href="http://flask.pocoo.org/">Flask</a> server) will be listening to the webhook and it will emit a MQTT event depending on the state</li>
  <li>Another Arduino device (one <a href="http://www.nodemcu.com/index_en.html">NodeMcu</a> in this case) will be listening to this MQTT event and it will activate a LED. Red one if the alert is ON and green one if the alert is OFF</li>
</ul>

<p><strong>The server</strong> As I said before we’ll need three servers:</p>

<ul>
  <li>MQTT server (mosquitto)</li>
  <li>InfluxDB server</li>
  <li>Grafana server</li>
</ul>

<p>We’ll use Docker. I’ve got a Docker host running in a Raspberry Pi3. The Raspberry Pi is a ARM device so we need docker images for this architecture.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">version</span><span class="pi">:</span> <span class="s1">'</span><span class="s">2'</span>
 
<span class="na">services</span><span class="pi">:</span>
  <span class="na">mosquitto</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">pascaldevink/rpi-mosquitto</span>
    <span class="na">container_name</span><span class="pi">:</span> <span class="s">moquitto</span>
    <span class="na">ports</span><span class="pi">:</span>
     <span class="pi">-</span> <span class="s2">"</span><span class="s">9001:9001"</span>
     <span class="pi">-</span> <span class="s2">"</span><span class="s">1883:1883"</span>
    <span class="na">restart</span><span class="pi">:</span> <span class="s">always</span>
   
  <span class="na">influxdb</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">hypriot/rpi-influxdb</span>
    <span class="na">container_name</span><span class="pi">:</span> <span class="s">influxdb</span>
    <span class="na">restart</span><span class="pi">:</span> <span class="s">always</span>
    <span class="na">environment</span><span class="pi">:</span>
     <span class="pi">-</span> <span class="s">INFLUXDB_INIT_PWD="password"</span>
     <span class="pi">-</span> <span class="s">PRE_CREATE_DB="iot"</span>
    <span class="na">ports</span><span class="pi">:</span>
     <span class="pi">-</span> <span class="s2">"</span><span class="s">8083:8083"</span>
     <span class="pi">-</span> <span class="s2">"</span><span class="s">8086:8086"</span>
    <span class="na">volumes</span><span class="pi">:</span>
     <span class="pi">-</span> <span class="s">~/docker/rpi-influxdb/data:/data</span>
 
  <span class="na">grafana</span><span class="pi">:</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">fg2it/grafana-armhf:v4.6.3</span>
    <span class="na">container_name</span><span class="pi">:</span> <span class="s">grafana</span>
    <span class="na">restart</span><span class="pi">:</span> <span class="s">always</span>
    <span class="na">ports</span><span class="pi">:</span>
     <span class="pi">-</span> <span class="s2">"</span><span class="s">3000:3000"</span>
    <span class="na">volumes</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">grafana-db:/var/lib/grafana</span>
      <span class="pi">-</span> <span class="s">grafana-log:/var/log/grafana</span>
      <span class="pi">-</span> <span class="s">grafana-conf:/etc/grafana</span>
 
<span class="na">volumes</span><span class="pi">:</span>
  <span class="na">grafana-db</span><span class="pi">:</span>
    <span class="na">driver</span><span class="pi">:</span> <span class="s">local</span>  
  <span class="na">grafana-log</span><span class="pi">:</span>
    <span class="na">driver</span><span class="pi">:</span> <span class="s">local</span>
  <span class="na">grafana-conf</span><span class="pi">:</span>
    <span class="na">driver</span><span class="pi">:</span> <span class="s">local</span>
</code></pre></div></div>

<p><strong>ESP32</strong> 
The Esp32 part is very simple. We only need to connect our potentiometer to the Esp32. The potentiometer has three pins: Gnd, Signal and Vcc. For signal we’ll use the pin 32.</p>

<p>We only need to configure our Wifi network, connect to our MQTT server and emit the potentiometer value within each loop.</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;PubSubClient.h&gt;
#include &lt;WiFi.h&gt;
</span> 
<span class="k">const</span> <span class="kt">int</span> <span class="n">potentiometerPin</span> <span class="o">=</span> <span class="mi">32</span><span class="p">;</span>
 
<span class="c1">// Wifi configuration</span>
<span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">ssid</span> <span class="o">=</span> <span class="s">"my_wifi_ssid"</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">password</span> <span class="o">=</span> <span class="s">"my_wifi_password"</span><span class="p">;</span>
 
<span class="c1">// MQTT configuration</span>
<span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">server</span> <span class="o">=</span> <span class="s">"192.168.1.111"</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">topic</span> <span class="o">=</span> <span class="s">"/pot"</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">clientName</span> <span class="o">=</span> <span class="s">"com.gonzalo123.esp32"</span><span class="p">;</span>
 
<span class="n">String</span> <span class="n">payload</span><span class="p">;</span>
 
<span class="n">WiFiClient</span> <span class="n">wifiClient</span><span class="p">;</span>
<span class="n">PubSubClient</span> <span class="nf">client</span><span class="p">(</span><span class="n">wifiClient</span><span class="p">);</span>
 
<span class="kt">void</span> <span class="nf">wifiConnect</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">();</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"Connecting to "</span><span class="p">);</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">ssid</span><span class="p">);</span>
 
  <span class="n">WiFi</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="n">ssid</span><span class="p">,</span> <span class="n">password</span><span class="p">);</span>
 
  <span class="k">while</span> <span class="p">(</span><span class="n">WiFi</span><span class="p">.</span><span class="n">status</span><span class="p">()</span> <span class="o">!=</span> <span class="n">WL_CONNECTED</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">delay</span><span class="p">(</span><span class="mi">500</span><span class="p">);</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"."</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">""</span><span class="p">);</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"WiFi connected."</span><span class="p">);</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"IP address: "</span><span class="p">);</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">WiFi</span><span class="p">.</span><span class="n">localIP</span><span class="p">());</span>
<span class="p">}</span>
 
<span class="kt">void</span> <span class="nf">mqttReConnect</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="n">client</span><span class="p">.</span><span class="n">connected</span><span class="p">())</span> <span class="p">{</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"Attempting MQTT connection..."</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">client</span><span class="p">.</span><span class="n">connect</span><span class="p">(</span><span class="n">clientName</span><span class="p">))</span> <span class="p">{</span>
      <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"connected"</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"failed, rc="</span><span class="p">);</span>
      <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">client</span><span class="p">.</span><span class="n">state</span><span class="p">());</span>
      <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">" try again in 5 seconds"</span><span class="p">);</span>
      <span class="n">delay</span><span class="p">(</span><span class="mi">5000</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
 
<span class="kt">void</span> <span class="nf">mqttEmit</span><span class="p">(</span><span class="n">String</span> <span class="n">topic</span><span class="p">,</span> <span class="n">String</span> <span class="n">value</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">client</span><span class="p">.</span><span class="n">publish</span><span class="p">((</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span> <span class="n">topic</span><span class="p">.</span><span class="n">c_str</span><span class="p">(),</span> <span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span> <span class="n">value</span><span class="p">.</span><span class="n">c_str</span><span class="p">());</span>
<span class="p">}</span>
 
<span class="kt">void</span> <span class="nf">setup</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">115200</span><span class="p">);</span>
 
  <span class="n">wifiConnect</span><span class="p">();</span>
  <span class="n">client</span><span class="p">.</span><span class="n">setServer</span><span class="p">(</span><span class="n">server</span><span class="p">,</span> <span class="mi">1883</span><span class="p">);</span>
  <span class="n">delay</span><span class="p">(</span><span class="mi">1500</span><span class="p">);</span>
<span class="p">}</span>
 
<span class="kt">void</span> <span class="nf">loop</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">client</span><span class="p">.</span><span class="n">connected</span><span class="p">())</span> <span class="p">{</span>
    <span class="n">mqttReConnect</span><span class="p">();</span>
  <span class="p">}</span>
  <span class="kt">int</span> <span class="n">current</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="p">((</span><span class="n">analogRead</span><span class="p">(</span><span class="n">potentiometerPin</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span> <span class="o">/</span> <span class="mi">4095</span><span class="p">);</span>
  <span class="n">mqttEmit</span><span class="p">(</span><span class="n">topic</span><span class="p">,</span> <span class="p">(</span><span class="n">String</span><span class="p">)</span> <span class="n">current</span><span class="p">);</span>
  <span class="n">delay</span><span class="p">(</span><span class="mi">500</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p><strong>Mqtt listener</strong></p>

<p>The esp32 emits an event (“/pot”) with the value of the potentiometer. So we’re going to create a MQTT listener that listen to MQTT and persits the value to InfluxDB.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">paho.mqtt.client</span> <span class="k">as</span> <span class="n">mqtt</span>
<span class="kn">from</span> <span class="nn">influxdb</span> <span class="kn">import</span> <span class="n">InfluxDBClient</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">logging</span>
 
 
<span class="k">def</span> <span class="nf">persists</span><span class="p">(</span><span class="n">msg</span><span class="p">):</span>
    <span class="n">current_time</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">.</span><span class="n">datetime</span><span class="p">.</span><span class="n">utcnow</span><span class="p">().</span><span class="n">isoformat</span><span class="p">()</span>
    <span class="n">json_body</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="s">"measurement"</span><span class="p">:</span> <span class="s">"pot"</span><span class="p">,</span>
            <span class="s">"tags"</span><span class="p">:</span> <span class="p">{},</span>
            <span class="s">"time"</span><span class="p">:</span> <span class="n">current_time</span><span class="p">,</span>
            <span class="s">"fields"</span><span class="p">:</span> <span class="p">{</span>
                <span class="s">"value"</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="n">payload</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">]</span>
    <span class="n">logging</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="n">json_body</span><span class="p">)</span>
    <span class="n">influx_client</span><span class="p">.</span><span class="n">write_points</span><span class="p">(</span><span class="n">json_body</span><span class="p">)</span>
 
 
<span class="n">logging</span><span class="p">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="p">.</span><span class="n">INFO</span><span class="p">)</span>
<span class="n">influx_client</span> <span class="o">=</span> <span class="n">InfluxDBClient</span><span class="p">(</span><span class="s">'docker'</span><span class="p">,</span> <span class="mi">8086</span><span class="p">,</span> <span class="n">database</span><span class="o">=</span><span class="s">'iot'</span><span class="p">)</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">mqtt</span><span class="p">.</span><span class="n">Client</span><span class="p">()</span>
 
<span class="n">client</span><span class="p">.</span><span class="n">on_connect</span> <span class="o">=</span> <span class="k">lambda</span> <span class="bp">self</span><span class="p">,</span> <span class="n">mosq</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">rc</span><span class="p">:</span> <span class="bp">self</span><span class="p">.</span><span class="n">subscribe</span><span class="p">(</span><span class="s">"/pot"</span><span class="p">)</span>
<span class="n">client</span><span class="p">.</span><span class="n">on_message</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">client</span><span class="p">,</span> <span class="n">userdata</span><span class="p">,</span> <span class="n">msg</span><span class="p">:</span> <span class="n">persists</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
 
<span class="n">client</span><span class="p">.</span><span class="n">connect</span><span class="p">(</span><span class="s">"docker"</span><span class="p">,</span> <span class="mi">1883</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span>
 
<span class="n">client</span><span class="p">.</span><span class="n">loop_forever</span><span class="p">()</span>
</code></pre></div></div>

<p><strong>Grafana</strong> 
In grafana we need to do two things. First to create one datasource from our InfluxDB server. It’s pretty straightforward to it.</p>

<p>Finally we’ll create a dashboard. We only have one time-serie with the value of the potentiometer. I must admit that my dasboard has a lot things that I’ve created only for fun.</p>

<p>Thats the query that I’m using to plot the main graph</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span>
  <span class="k">last</span><span class="p">(</span><span class="nv">"value"</span><span class="p">)</span> <span class="k">FROM</span> <span class="nv">"pot"</span>
<span class="k">WHERE</span>
  <span class="nb">time</span> <span class="o">&gt;=</span> <span class="n">now</span><span class="p">()</span> <span class="o">-</span> <span class="mi">5</span><span class="n">m</span> 
<span class="k">GROUP</span> <span class="k">BY</span>
  <span class="nb">time</span><span class="p">(</span><span class="err">$</span><span class="n">interval</span><span class="p">)</span> <span class="n">fill</span><span class="p">(</span><span class="n">previous</span><span class="p">)</span>
</code></pre></div></div>

<p>Here we can see the dashboard</p>

<p><img src="/assets/images/dashboard.png" alt="" /></p>

<p>And here my alert configuration:</p>

<p><img src="/assets/images/alert.png" alt="" /></p>

<p>I’ve also created a notification channel with a webhook. Grafana will use this web hook to notify when the state of alert changes</p>

<p><strong>Webhook listener</strong></p>

<p>Grafana will emit a webhook, so we’ll need an REST endpoint to collect the webhook calls. I normally use PHP/Lumen to create REST servers but in this project I’ll use Python and Flask.</p>

<p>We need to handle HTTP Basic Auth and emmit a MQTT event. MQTT is a very simple protocol but it has one very nice feature that fits like hat fits like a glove here. Le me explain it:</p>

<p>Imagine that we’ve got our system up and running and the state is “ok”. Now we connect one device (for example one big red/green lights). Since the “ok” event was fired before we connect the lights, our green light will not be switch on. We need to wait util “alert” event if we want to see any light. That’s not cool.</p>

<p>MQTT allows us to “retain” messages. That means that we can emit messages with “retain” flag to one topic and when we connect one device later to this topic, it will receive the message. Here it’s exactly what we need.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span>
<span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">request</span>
<span class="kn">from</span> <span class="nn">flask_httpauth</span> <span class="kn">import</span> <span class="n">HTTPBasicAuth</span>
<span class="kn">import</span> <span class="nn">paho.mqtt.client</span> <span class="k">as</span> <span class="n">mqtt</span>
<span class="kn">import</span> <span class="nn">json</span>
 
<span class="n">client</span> <span class="o">=</span> <span class="n">mqtt</span><span class="p">.</span><span class="n">Client</span><span class="p">()</span>
 
<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>
<span class="n">auth</span> <span class="o">=</span> <span class="n">HTTPBasicAuth</span><span class="p">()</span>
 
<span class="c1"># http basic auth credentials
</span><span class="n">users</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">"user"</span><span class="p">:</span> <span class="s">"password"</span>
<span class="p">}</span>
 
 
<span class="o">@</span><span class="n">auth</span><span class="p">.</span><span class="n">get_password</span>
<span class="k">def</span> <span class="nf">get_pw</span><span class="p">(</span><span class="n">username</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">username</span> <span class="ow">in</span> <span class="n">users</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">users</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">username</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">None</span>
 
 
<span class="o">@</span><span class="n">app</span><span class="p">.</span><span class="n">route</span><span class="p">(</span><span class="s">'/alert'</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s">'POST'</span><span class="p">])</span>
<span class="o">@</span><span class="n">auth</span><span class="p">.</span><span class="n">login_required</span>
<span class="k">def</span> <span class="nf">alert</span><span class="p">():</span>
    <span class="n">client</span><span class="p">.</span><span class="n">connect</span><span class="p">(</span><span class="s">"docker"</span><span class="p">,</span> <span class="mi">1883</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="p">.</span><span class="n">loads</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="n">decode</span><span class="p">(</span><span class="s">'utf-8'</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="s">'state'</span><span class="p">]</span> <span class="o">==</span> <span class="s">'alerting'</span><span class="p">:</span>
        <span class="n">client</span><span class="p">.</span><span class="n">publish</span><span class="p">(</span><span class="n">topic</span><span class="o">=</span><span class="s">"/alert"</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="s">"1"</span><span class="p">,</span> <span class="n">retain</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">data</span><span class="p">[</span><span class="s">'state'</span><span class="p">]</span> <span class="o">==</span> <span class="s">'ok'</span><span class="p">:</span>
        <span class="n">client</span><span class="p">.</span><span class="n">publish</span><span class="p">(</span><span class="n">topic</span><span class="o">=</span><span class="s">"/alert"</span><span class="p">,</span> <span class="n">payload</span><span class="o">=</span><span class="s">"0"</span><span class="p">,</span> <span class="n">retain</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
 
    <span class="n">client</span><span class="p">.</span><span class="n">disconnect</span><span class="p">()</span>
 
    <span class="k">return</span> <span class="s">"ok"</span>
 
 
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">app</span><span class="p">.</span><span class="n">run</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="s">'0.0.0.0'</span><span class="p">)</span>
</code></pre></div></div>

<p><strong>Nodemcu</strong></p>

<p>Finally the Nodemcu. This part is similar than the esp32 one. Our leds are in pins 4 and 5. We also need to configure the Wifi and connect to to MQTT server. Nodemcu and esp32 are similar devices but not the same. For example we need to use different libraries to connect to the wifi.</p>

<p>This device will be listening to the MQTT event and trigger on led or another depending on the state</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;PubSubClient.h&gt;
#include &lt;ESP8266WiFi.h&gt;
</span> 
<span class="k">const</span> <span class="kt">int</span> <span class="n">ledRed</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">ledGreen</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
 
<span class="c1">// Wifi configuration</span>
<span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">ssid</span> <span class="o">=</span> <span class="s">"my_wifi_ssid"</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">password</span> <span class="o">=</span> <span class="s">"my_wifi_password"</span><span class="p">;</span>
 
<span class="c1">// mqtt configuration</span>
<span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">server</span> <span class="o">=</span> <span class="s">"192.168.1.111"</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">topic</span> <span class="o">=</span> <span class="s">"/alert"</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">clientName</span> <span class="o">=</span> <span class="s">"com.gonzalo123.nodemcu"</span><span class="p">;</span>
 
<span class="kt">int</span> <span class="n">value</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">percent</span><span class="p">;</span>
<span class="n">String</span> <span class="n">payload</span><span class="p">;</span>
 
<span class="n">WiFiClient</span> <span class="n">wifiClient</span><span class="p">;</span>
<span class="n">PubSubClient</span> <span class="nf">client</span><span class="p">(</span><span class="n">wifiClient</span><span class="p">);</span>
 
<span class="kt">void</span> <span class="nf">wifiConnect</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">();</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"Connecting to "</span><span class="p">);</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">ssid</span><span class="p">);</span>
 
  <span class="n">WiFi</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="n">ssid</span><span class="p">,</span> <span class="n">password</span><span class="p">);</span>
 
  <span class="k">while</span> <span class="p">(</span><span class="n">WiFi</span><span class="p">.</span><span class="n">status</span><span class="p">()</span> <span class="o">!=</span> <span class="n">WL_CONNECTED</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">delay</span><span class="p">(</span><span class="mi">500</span><span class="p">);</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"."</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">""</span><span class="p">);</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"WiFi connected."</span><span class="p">);</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"IP address: "</span><span class="p">);</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="n">WiFi</span><span class="p">.</span><span class="n">localIP</span><span class="p">());</span>
<span class="p">}</span>
 
<span class="kt">void</span> <span class="nf">mqttReConnect</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="n">client</span><span class="p">.</span><span class="n">connected</span><span class="p">())</span> <span class="p">{</span>
    <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"Attempting MQTT connection..."</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">client</span><span class="p">.</span><span class="n">connect</span><span class="p">(</span><span class="n">clientName</span><span class="p">))</span> <span class="p">{</span>
      <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"connected"</span><span class="p">);</span>
      <span class="n">client</span><span class="p">.</span><span class="n">subscribe</span><span class="p">(</span><span class="n">topic</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"failed, rc="</span><span class="p">);</span>
      <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">client</span><span class="p">.</span><span class="n">state</span><span class="p">());</span>
      <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">" try again in 5 seconds"</span><span class="p">);</span>
      <span class="n">delay</span><span class="p">(</span><span class="mi">5000</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
 
<span class="kt">void</span> <span class="nf">callback</span><span class="p">(</span><span class="kt">char</span><span class="o">*</span> <span class="n">topic</span><span class="p">,</span> <span class="n">byte</span><span class="o">*</span> <span class="n">payload</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">length</span><span class="p">)</span> <span class="p">{</span>
 
  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"Message arrived ["</span><span class="p">);</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">topic</span><span class="p">);</span>
 
  <span class="n">String</span> <span class="n">data</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">length</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">data</span> <span class="o">+=</span> <span class="p">(</span><span class="kt">char</span><span class="p">)</span><span class="n">payload</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
  <span class="p">}</span>
  <span class="n">cleanLeds</span><span class="p">();</span>
  <span class="kt">int</span> <span class="n">value</span> <span class="o">=</span> <span class="n">data</span><span class="p">.</span><span class="n">toInt</span><span class="p">();</span>
  <span class="k">switch</span> <span class="p">(</span><span class="n">value</span><span class="p">)</span>  <span class="p">{</span>
    <span class="k">case</span> <span class="mi">1</span><span class="p">:</span>
      <span class="n">digitalWrite</span><span class="p">(</span><span class="n">ledRed</span><span class="p">,</span> <span class="n">HIGH</span><span class="p">);</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="k">case</span> <span class="mi">0</span><span class="p">:</span>
      <span class="n">digitalWrite</span><span class="p">(</span><span class="n">ledGreen</span><span class="p">,</span> <span class="n">HIGH</span><span class="p">);</span>
      <span class="k">break</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"] value:"</span><span class="p">);</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">((</span><span class="kt">int</span><span class="p">)</span> <span class="n">value</span><span class="p">);</span>
<span class="p">}</span>
 
<span class="kt">void</span> <span class="nf">cleanLeds</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">digitalWrite</span><span class="p">(</span><span class="n">ledRed</span><span class="p">,</span> <span class="n">LOW</span><span class="p">);</span>
  <span class="n">digitalWrite</span><span class="p">(</span><span class="n">ledGreen</span><span class="p">,</span> <span class="n">LOW</span><span class="p">);</span>
<span class="p">}</span>
 
<span class="kt">void</span> <span class="nf">setup</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">begin</span><span class="p">(</span><span class="mi">9600</span><span class="p">);</span>
  <span class="n">pinMode</span><span class="p">(</span><span class="n">ledRed</span><span class="p">,</span> <span class="n">OUTPUT</span><span class="p">);</span>
  <span class="n">pinMode</span><span class="p">(</span><span class="n">ledGreen</span><span class="p">,</span> <span class="n">OUTPUT</span><span class="p">);</span>
  <span class="n">cleanLeds</span><span class="p">();</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">println</span><span class="p">(</span><span class="s">"start"</span><span class="p">);</span>
 
  <span class="n">wifiConnect</span><span class="p">();</span>
  <span class="n">client</span><span class="p">.</span><span class="n">setServer</span><span class="p">(</span><span class="n">server</span><span class="p">,</span> <span class="mi">1883</span><span class="p">);</span>
  <span class="n">client</span><span class="p">.</span><span class="n">setCallback</span><span class="p">(</span><span class="n">callback</span><span class="p">);</span>
 
  <span class="n">delay</span><span class="p">(</span><span class="mi">1500</span><span class="p">);</span>
<span class="p">}</span>
 
<span class="kt">void</span> <span class="nf">loop</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">Serial</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="s">"."</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">client</span><span class="p">.</span><span class="n">connected</span><span class="p">())</span> <span class="p">{</span>
    <span class="n">mqttReConnect</span><span class="p">();</span>
  <span class="p">}</span>
 
  <span class="n">client</span><span class="p">.</span><span class="n">loop</span><span class="p">();</span>
  <span class="n">delay</span><span class="p">(</span><span class="mi">500</span><span class="p">);</span>
</code></pre></div></div>

<p>Here you can see the working prototype in action</p>

<p><a href="https://www.youtube.com/watch?v=T7CzdaEY740"><img src="https://img.youtube.com/vi/T7CzdaEY740/0.jpg" alt="youtube" /></a></p>

<p>And here the source <a href="https://github.com/gonzalo123/iot.grafana">code</a></p>



    </section>
    <p>
        <div class="page-share">
  <a href="https://twitter.com/intent/tweet?text=Playing+with+Docker%2C+MQTT%2C+Grafana%2C+InfluxDB%2C+Python+and+Arduino%20http%3A%2F%2Flocalhost%3A4000%2F2018%2F06%2F04%2Fplaying-with-docker-mqtt-grafana-influxdb-python-and-arduino%2F" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" class="btn btn--twitter btn--small"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i> <span>Tweet</span></a>
  <a href="https://www.linkedin.com/shareArticle?mini=true&url=http%3A%2F%2Flocalhost%3A4000%2F2018%2F06%2F04%2Fplaying-with-docker-mqtt-grafana-influxdb-python-and-arduino%2F" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" class="btn btn--linkedin btn--small"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i> <span>LinkedIn</span></a>
  <a href="https://reddit.com/submit?title=Playing+with+Docker%2C+MQTT%2C+Grafana%2C+InfluxDB%2C+Python+and+Arduino&url=http%3A%2F%2Flocalhost%3A4000%2F2018%2F06%2F04%2Fplaying-with-docker-mqtt-grafana-influxdb-python-and-arduino%2F" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" class="btn btn--reddit btn--small"><i class="fab fa-fw fa-reddit" aria-hidden="true"></i> <span>Reddit</span></a>
</div>

    </p>
    
    <section id="disqus_thread"></section><!-- /#disqus_thread -->
</article>

    <script type="text/javascript">
      var disqus_config = function () {
        this.page.url = 'http://localhost:4000/2018/06/04/playing-with-docker-mqtt-grafana-influxdb-python-and-arduino/';  // Replace PAGE_URL with your page's canonical URL variable
        this.page.identifier = '/2018/06/04/playing-with-docker-mqtt-grafana-influxdb-python-and-arduino'; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
      };

      (function() { // DON'T EDIT BELOW THIS LINE
        var d = document, s = d.createElement('script');
        s.src = '//gonzalo123-com.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
       })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>




<div class="related">
    <h2>Related Posts</h2>
    <ul>
        
        <a href="/2021/03/08/playing-with-go-and-file-system-watchers/">
            <li>
                <h3>Playing with Go and file system watchers&nbsp;&nbsp;08 Mar 2021</h3>
            </li>
        </a>
        
        <a href="/2021/02/15/database-utils-for-psycopg2/">
            <li>
                <h3>Database utils for psycopg2&nbsp;&nbsp;15 Feb 2021</h3>
            </li>
        </a>
        
        <a href="/2021/01/11/playing-with-rabbitmq-python-and-docker-from-exchanges-to-queues/">
            <li>
                <h3>Playing with RabbitMQ, Python and Docker. From Exchanges to Queues&nbsp;&nbsp;11 Jan 2021</h3>
            </li>
        </a>
        
    </ul>
</div>

      </div>

      <footer class="footer">
  <span class="footer__copyright">&copy; 2021 Gonzalo Ayuso. All rights reserved.</span>
</footer>

<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script type="text/javascript" src="/js/main.js?1617453037860382000"></script>


    </div>
  </body>
</html>
